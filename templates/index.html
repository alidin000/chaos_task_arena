<!DOCTYPE html>
<html>
<head>
    <title>Chaos Arena</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <h1>Chaos Task Arena</h1>
    <input type="range" id="chance" min="0.1" max="0.9" step="0.1" value="0.5">
    <input type="number" id="count" value="10" min="1">
    <button onclick="launch()">Launch Chaos</button>
    <canvas id="chart" width="400" height="200"></canvas>

    <script>
        async function launch() {
            const chance = document.getElementById("chance").value;
            const count = document.getElementById("count").value;
            await fetch(`/run?chance=${chance}&count=${count}`);
        }

        const ctx = document.getElementById('chart').getContext('2d');
        const chart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: ['Success', 'Retry', 'Failed'],
                datasets: [{
                    label: 'Tasks',
                    data: [0, 0, 0],
                    backgroundColor: ['green', 'orange', 'red']
                }]
            }
        });

        setInterval(async () => {
            const res = await fetch('/stats');
            const data = await res.json();
            chart.data.datasets[0].data = [data.success, data.retry, data.failed];
            chart.update();
        }, 1000);
    </script>
</body>
</html>
